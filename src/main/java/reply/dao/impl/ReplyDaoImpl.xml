<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reply.dao.face.ReplyDao">

	<resultMap type="dto.NoticeReply" id="NoticeReply">
    	<result column="nickname" property="writer"/>
    </resultMap>
	
<!-- 공지사항 댓글쿼리 시작 -->
<select id="selectComment"
		parameterType="dto.Notice"
		resultMap="NoticeReply">
			    SELECT * FROM (
				SELECT rownum rnum, B.* FROM (
				SELECT
                        reply_idx,
						reply,
						notice_idx,
						writtendate,
						member.nickname,
						step
						
					FROM notice_reply, member
					WHERE notice_reply.member_idx = member.member_idx 
					AND notice_idx = #{notice_idx }					
					ORDER BY step DESC
					) B
				) ORDER BY rnum

</select>

<select id="countComment"
		parameterType="dto.NoticeReply"
		resultType="int">
		
		SELECT COUNT(*) FROM notice_reply
		WHERE reply_idx = #{reply_idx }



</select>




<insert id="insertNoticeReply"
		parameterType="dto.NoticeReply">
INSERT INTO notice_reply(reply_idx, notice_idx, member_idx, reply, step )
VALUES(notice_reply_seq.nextval,#{notice_idx },#{member_idx }, #{reply },(SELECT MAX(step)+1 FROM notice_reply ) )


</insert>


<delete id="deleteComment"
		parameterType="dto.NoticeReply">
	DELETE notice_reply
	WHERE reply_idx = #{reply_idx } 

</delete>






<!--  공지사항 댓글쿼리 끝  -->


</mapper>
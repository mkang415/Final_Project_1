<?xml version="1.0" encoding="UTF-8"?>

<!--  마이바티스 3 Mapper DOCTYPE -->
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

        <mapper namespace="notice.dao.face.NoticeDao">

		<!-- select 문 -->
       <select id="selectAll"
    		parameterType="util.NoticePaging"
            resultType="dto.Notice">
 
    		SELECT * FROM (
                SELECT rownum rnum, B.* FROM (
				SELECT notice_idx, title, content, member_idx, hit, writtendate FROM notice
				ORDER BY notice_idx DESC
		 	)B
			ORDER BY rnum
		) notice
		WHERE rnum BETWEEN #{startNo } AND #{endNo }
    
    </select>   
    
    <select id="selectCntAll"
    		resultType="int">
    		
    		SELECT COUNT(*)
    		FROM notice
    		
    </select>
    
        <select id="selectNoticeByNoticeno"
    		parameterType="dto.Notice"
    		resultType="dto.Notice">
        		SELECT  
        		
        		notice_idx, 
        		title, 
        		content, 
        		member_idx, 
        		hit, 
        		writtendate 
        		FROM notice
				WHERE notice_idx = #{notice_idx }
    </select>
    
        <select id="selectFilebynotice_idx"
    		parameterType="dto.Notice"
    		resultType="dto.NoticeFile">
    			SELECT fileno, 
    			origin_name, 
    			stored_name, 
    			notice_idx 
    			
    			FROM 
    			NoticeFile
    			
    			WHERE 
    			notice_idx = #{notice_idx }
	
    </select>
    
    <select id="getFilebyFileNo"
    		parameterType="int"
    		resultType="dto.NoticeFile">
    		
    			SELECT fileno, 
    			origin_name, 
    			stored_name, 
    			notice_idx 
    			
    			FROM 
    			NoticeFile
    			
    			WHERE 
    			fileno = #{fileno }
    		
    </select>
    <!--  -->  
    
    <!-- update -->
        <update id="updateHit"
    		parameterType="dto.Notice">
    		UPDATE notice
    		SET hit = hit+1
    		WHERE notice_idx = #{notice_idx }
    
   		 </update>
   
     <!--  -->
     
     <!-- insert -->
     
     <insert id="insertBoard"
     		 parameterType="dto.Notice">
     
     	<selectKey order="BEFORE" resultType="int" keyProperty="notice_idx" >
				SELECT notice_seq.nextval
				FROM 
				dual  
		</selectKey>
			
	INSERT INTO notice ( notice_idx, title, content, member_idx  ) 
	VALUES ( #{notice_idx }, #{title }, #{content }, #{member_idx } )
     
     
     </insert>
     
     
     <insert id="insertFile"
     		parameterType="dto.NoticeFile">
     		
     	INSERT INTO NoticeFile(fileno, origin_name, stored_name, notice_idx )
		VALUES (NoticeFile_seq.nextval, #{origin_name }, #{stored_name }, #{notice_idx }  )
     
     
     </insert>   
        
        
     <!--       -->   
        
        
        </mapper>
    